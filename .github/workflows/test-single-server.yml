name: Execute Kaggle Notebook

on:
  # Trigger when you save/push this file
  push:
  # Also allows you to click a "Run" button manually in GitHub Actions tab
  workflow_dispatch:

jobs:
  trigger-new-version:
    runs-on: ubuntu-latest
    
    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Kaggle CLI
        run: pip install kaggle

      - name: Pull and Restart Kernel
        env:
          KAGGLE_USERNAME: "shreevathsbbhh"
          KAGGLE_KEY: "83a92caa96ed51b5d5a9a730100c57aa"
        run: |
          # Create a temporary folder to work in
          mkdir kaggle_run
          cd kaggle_run

          # 1. Download the current notebook and metadata directly from Kaggle
          # -m gets the metadata, -p . saves to current folder
          kaggle kernels pull shreevathsbbhh/gpusss -m -p .

          # 2. Push it back to Kaggle
          # This forces Kaggle to start a "New Version" execution immediately
          kaggle kernels push -p .
